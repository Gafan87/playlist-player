<!DOCTYPE html>
<html>
<head>
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>body{margin:0;height:100vh;}#player{width:100%;height:100%;}</style>
</head>
<body>
  <div id="player"></div>
  <script>
    var videos = [
      {id: 'S69w0zMW-A0', start: 0, duration: 85},
      {id: 'MvofQDdXSR4', start: 15, duration: 75}
    ];
    var current = 0;
    var player;
    var fadeTime = 2;
    var startTime;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        width: '100%',
        height: '100%',
        videoId: videos[0].id,
        playerVars: { autoplay: 1, rel: 0, modestbranding: 1 },
        events: { onReady: onPlayerReady, onStateChange: onStateChange }
      });
    }

    function onPlayerReady(event) {
      loadVideo(current);
      fadeVolume(0, 1, fadeTime);
    }

    function loadVideo(idx) {
      startTime = Date.now();
      player.loadVideoById(videos[idx].id);
      player.seekTo(videos[idx].start, true);
    }

    function onStateChange(event) {
      if (event.data == YT.PlayerState.PLAYING) {
        player.seekTo(videos[current].start, true);  // Гарантируем start
      }
      if (event.data == YT.PlayerState.ENDED || (Date.now() - startTime > videos[current].duration * 1000)) {
        fadeVolume(1, 0, fadeTime / 2, function() {
          current++;
          if (current < videos.length) {
            setTimeout(function() {
              loadVideo(current);
              fadeVolume(0, 1, fadeTime);
            }, 1000);
          }
        });
      }
    }

    function fadeVolume(fromVol, toVol, duration, callback) {
      var steps = 20;
      var stepTime = duration * 1000 / steps;
      var step = (toVol - fromVol) / steps;
      var vol = fromVol;
      var int = setInterval(function() {
        vol += step;
        player.setVolume(Math.round(Math.max(0, Math.min(100, vol * 100))));
        if (Math.abs(vol - toVol) < Math.abs(step)) {
          clearInterval(int);
          if (callback) callback();
        }
      }, stepTime);
    }
  </script>
</body>
</html>